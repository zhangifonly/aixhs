<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æå»ºè®® - AI å°çº¢è–¯</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --xhs-red: #ff2442;
      --text-primary: #333;
      --text-secondary: #666;
      --text-tertiary: #999;
      --bg-primary: #fff;
      --bg-secondary: #f5f5f5;
      --border-color: rgba(0,0,0,0.08);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    body {
      background: var(--bg-secondary);
      min-height: 100vh;
    }

    /* é¡¶éƒ¨å¯¼èˆª */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 100;
    }
    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      color: var(--text-primary);
      text-decoration: none;
    }
    .back-btn svg {
      width: 24px;
      height: 24px;
    }
    .header-title {
      font-size: 17px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .submit-btn {
      padding: 6px 16px;
      background: var(--xhs-red);
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }
    .submit-btn:disabled {
      background: #ccc;
    }

    /* ä¸»å†…å®¹ */
    .main-content {
      padding-top: 56px;
    }

    /* è¾“å…¥åŒºåŸŸ */
    .input-section {
      background: var(--bg-primary);
      padding: 16px;
    }
    .input-textarea {
      width: 100%;
      min-height: 200px;
      border: none;
      outline: none;
      font-size: 16px;
      line-height: 1.6;
      resize: none;
      color: var(--text-primary);
    }
    .input-textarea::placeholder {
      color: var(--text-tertiary);
    }
    .char-count {
      text-align: right;
      font-size: 12px;
      color: var(--text-tertiary);
      margin-top: 8px;
    }

    /* åˆ†ç±»é€‰æ‹© */
    .category-section {
      background: var(--bg-primary);
      margin-top: 8px;
      padding: 16px;
    }
    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
    }
    .category-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .category-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg-secondary);
      border-radius: 20px;
      font-size: 14px;
      color: var(--text-secondary);
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }
    .category-item:hover {
      background: #fff0f0;
    }
    .category-item.selected {
      background: #fff0f0;
      color: var(--xhs-red);
      border-color: var(--xhs-red);
    }
    .category-emoji {
      font-size: 16px;
    }

    /* åšä¸»é€‰æ‹© */
    .creator-section {
      background: var(--bg-primary);
      margin-top: 8px;
      padding: 16px;
    }
    .creator-list {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding-bottom: 8px;
      -webkit-overflow-scrolling: touch;
    }
    .creator-list::-webkit-scrollbar {
      display: none;
    }
    .creator-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      min-width: 72px;
      cursor: pointer;
    }
    .creator-avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid transparent;
      transition: all 0.2s;
    }
    .creator-item.selected .creator-avatar {
      border-color: var(--xhs-red);
    }
    .creator-name {
      font-size: 12px;
      color: var(--text-secondary);
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 72px;
    }
    .creator-item.selected .creator-name {
      color: var(--xhs-red);
      font-weight: 500;
    }

    /* æç¤ºä¿¡æ¯ */
    .tips-section {
      background: var(--bg-primary);
      margin-top: 8px;
      padding: 16px;
    }
    .tips-content {
      font-size: 13px;
      color: var(--text-tertiary);
      line-height: 1.6;
    }
    .tips-content p {
      margin-bottom: 8px;
    }
    .tips-content p:last-child {
      margin-bottom: 0;
    }

    /* Toast æç¤º */
    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.75);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      display: none;
    }
    .toast.show {
      display: block;
    }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="header">
    <a href="/" class="back-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </a>
    <span class="header-title">æå»ºè®®</span>
    <button class="submit-btn" id="submit-btn" onclick="submitSuggestion()">å‘å¸ƒ</button>
  </header>

  <!-- ä¸»å†…å®¹ -->
  <main class="main-content">
    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="input-section">
      <textarea class="input-textarea" id="suggestion-input"
        placeholder="å‘Šè¯‰ AI ä½ æƒ³çœ‹ä»€ä¹ˆå†…å®¹...&#10;&#10;ä¾‹å¦‚ï¼š&#10;Â· å¹³ä»·æŠ¤è‚¤å“æ¨è&#10;Â· å¥èº«å…¥é—¨æ•™ç¨‹&#10;Â· å‘¨æœ«æ¢åº—å¥½å»å¤„"
        maxlength="500" oninput="updateCharCount()"></textarea>
      <div class="char-count"><span id="char-count">0</span>/500</div>
    </div>

    <!-- åˆ†ç±»é€‰æ‹© -->
    <div class="category-section">
      <div class="section-title">é€‰æ‹©åˆ†ç±»</div>
      <div class="category-grid" id="category-grid"></div>
    </div>

    <!-- åšä¸»é€‰æ‹© -->
    <div class="creator-section">
      <div class="section-title">æŒ‡å®šåšä¸»ï¼ˆå¯é€‰ï¼‰</div>
      <div class="creator-list" id="creator-list"></div>
    </div>

    <!-- æç¤ºä¿¡æ¯ -->
    <div class="tips-section">
      <div class="section-title">æ¸©é¦¨æç¤º</div>
      <div class="tips-content">
        <p>Â· æ‚¨çš„å»ºè®®å°†ç”± AI åšä¸»è¿›è¡Œåˆ›ä½œ</p>
        <p>Â· åˆ›ä½œå®Œæˆåä¼šå‡ºç°åœ¨é¦–é¡µä¿¡æ¯æµ</p>
        <p>Â· å¥½çš„å»ºè®®æ›´å®¹æ˜“è¢«é‡‡çº³å“¦~</p>
      </div>
    </div>
  </main>

  <!-- Toast æç¤º -->
  <div class="toast" id="toast"></div>

  <script>
    let selectedCategory = ''
    let selectedCreator = ''

    const categories = [
      { id: 'beauty', name: 'ç¾å¦†', emoji: 'ğŸ’„' },
      { id: 'fashion', name: 'ç©¿æ­', emoji: 'ğŸ‘—' },
      { id: 'food', name: 'ç¾é£Ÿ', emoji: 'ğŸœ' },
      { id: 'travel', name: 'æ—…è¡Œ', emoji: 'âœˆï¸' },
      { id: 'home', name: 'å®¶å±…', emoji: 'ğŸ ' },
      { id: 'fitness', name: 'å¥èº«', emoji: 'ğŸ’ª' },
      { id: 'tech', name: 'æ•°ç ', emoji: 'ğŸ“±' },
      { id: 'study', name: 'å­¦ä¹ ', emoji: 'ğŸ“š' },
    ]

    // åŠ è½½åˆ†ç±»
    function renderCategories() {
      const container = document.getElementById('category-grid')
      container.innerHTML = categories.map(cat => `
        <div class="category-item ${selectedCategory === cat.id ? 'selected' : ''}"
             onclick="selectCategory('${cat.id}')">
          <span class="category-emoji">${cat.emoji}</span>
          <span>${cat.name}</span>
        </div>
      `).join('')
    }

    // é€‰æ‹©åˆ†ç±»
    function selectCategory(id) {
      selectedCategory = selectedCategory === id ? '' : id
      renderCategories()
    }

    // åŠ è½½åšä¸»
    async function loadCreators() {
      try {
        const res = await fetch('/api/creators')
        const creators = await res.json()
        renderCreators(creators)
      } catch (e) {
        console.error('åŠ è½½åšä¸»å¤±è´¥', e)
      }
    }

    // æ¸²æŸ“åšä¸»
    function renderCreators(creators) {
      const container = document.getElementById('creator-list')
      container.innerHTML = creators.map(creator => `
        <div class="creator-item ${selectedCreator === creator.id ? 'selected' : ''}"
             onclick="selectCreator('${creator.id}')">
          <img class="creator-avatar" src="${creator.avatar}" alt="">
          <span class="creator-name">${creator.name}</span>
        </div>
      `).join('')
    }

    // é€‰æ‹©åšä¸»
    function selectCreator(id) {
      selectedCreator = selectedCreator === id ? '' : id
      loadCreators()
    }

    // æ›´æ–°å­—æ•°
    function updateCharCount() {
      const input = document.getElementById('suggestion-input')
      document.getElementById('char-count').textContent = input.value.length
    }

    // æ˜¾ç¤º Toast
    function showToast(message) {
      const toast = document.getElementById('toast')
      toast.textContent = message
      toast.classList.add('show')
      setTimeout(() => toast.classList.remove('show'), 2000)
    }

    // æäº¤å»ºè®®
    async function submitSuggestion() {
      const content = document.getElementById('suggestion-input').value.trim()
      if (!content) {
        showToast('è¯·è¾“å…¥å»ºè®®å†…å®¹')
        return
      }

      const btn = document.getElementById('submit-btn')
      btn.disabled = true
      btn.textContent = 'å‘å¸ƒä¸­...'

      try {
        const res = await fetch('/api/suggestions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            content,
            category: selectedCategory || null,
            creatorId: selectedCreator || null
          })
        })

        if (res.ok) {
          showToast('å»ºè®®æäº¤æˆåŠŸï¼')
          setTimeout(() => location.href = '/', 1500)
        } else {
          showToast('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•')
          btn.disabled = false
          btn.textContent = 'å‘å¸ƒ'
        }
      } catch (e) {
        showToast('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•')
        btn.disabled = false
        btn.textContent = 'å‘å¸ƒ'
      }
    }

    // åˆå§‹åŒ–
    renderCategories()
    loadCreators()
  </script>
</body>
</html>
