<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æœç´¢ - AI å°çº¢è–¯</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --xhs-red: #ff2442;
      --text-primary: #333;
      --text-secondary: #666;
      --text-tertiary: #999;
      --bg-primary: #fff;
      --bg-secondary: #f5f5f5;
      --border-color: rgba(0,0,0,0.08);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    body {
      background: var(--bg-secondary);
      min-height: 100vh;
    }

    /* æœç´¢å¤´éƒ¨ */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: var(--bg-primary);
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 12px;
      z-index: 100;
      border-bottom: 1px solid var(--border-color);
    }
    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      color: var(--text-primary);
      text-decoration: none;
    }
    .back-btn svg {
      width: 24px;
      height: 24px;
    }
    .search-input-wrapper {
      flex: 1;
      height: 36px;
      background: var(--bg-secondary);
      border-radius: 18px;
      display: flex;
      align-items: center;
      padding: 0 14px;
      gap: 8px;
    }
    .search-input-wrapper svg {
      width: 18px;
      height: 18px;
      color: var(--text-tertiary);
      flex-shrink: 0;
    }
    .search-input {
      flex: 1;
      border: none;
      background: none;
      font-size: 14px;
      color: var(--text-primary);
      outline: none;
    }
    .search-input::placeholder {
      color: var(--text-tertiary);
    }
    .clear-btn {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--text-tertiary);
      color: white;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
    }
    .clear-btn.show {
      display: flex;
    }
    .search-btn {
      color: var(--xhs-red);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
    }

    /* ä¸»å†…å®¹ */
    .main-content {
      padding-top: 56px;
    }

    /* æœç´¢å†å²/çƒ­é—¨ */
    .suggest-section {
      background: var(--bg-primary);
      padding: 16px;
    }
    .suggest-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .suggest-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .suggest-clear {
      font-size: 13px;
      color: var(--text-tertiary);
      cursor: pointer;
    }
    .suggest-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .suggest-tag {
      padding: 6px 14px;
      background: var(--bg-secondary);
      border-radius: 16px;
      font-size: 13px;
      color: var(--text-secondary);
      cursor: pointer;
    }
    .suggest-tag:hover {
      background: #eee;
    }

    /* çƒ­æœæ¦œ */
    .hot-section {
      background: var(--bg-primary);
      margin-top: 8px;
      padding: 16px;
    }
    .hot-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .hot-item {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }
    .hot-rank {
      width: 20px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
    }
    .hot-rank.top1 { color: #ff2442; }
    .hot-rank.top2 { color: #ff6b4a; }
    .hot-rank.top3 { color: #ffa940; }
    .hot-rank.normal { color: var(--text-tertiary); }
    .hot-content {
      flex: 1;
      min-width: 0;
    }
    .hot-title {
      font-size: 14px;
      color: var(--text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .hot-badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 8px;
      margin-left: 8px;
    }
    .hot-badge.hot { background: #ffe4e8; color: #ff2442; }
    .hot-badge.new { background: #e4f4ff; color: #2f7cf5; }
    .hot-heat {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    /* æœç´¢ç»“æœ */
    .result-section {
      display: none;
    }
    .result-section.show {
      display: block;
    }

    /* ç»“æœæ ‡ç­¾é¡µ */
    .result-tabs {
      background: var(--bg-primary);
      display: flex;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 56px;
      z-index: 50;
    }
    .result-tab {
      flex: 1;
      padding: 14px 0;
      text-align: center;
      font-size: 14px;
      color: var(--text-secondary);
      cursor: pointer;
      position: relative;
    }
    .result-tab.active {
      color: var(--text-primary);
      font-weight: 600;
    }
    .result-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 2px;
      background: var(--xhs-red);
      border-radius: 1px;
    }

    /* ç¬”è®°ç»“æœ */
    .notes-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      padding: 8px;
    }
    .note-card {
      background: var(--bg-primary);
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      text-decoration: none;
    }
    .note-cover {
      width: 100%;
      aspect-ratio: 3/4;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
    }
    .note-info {
      padding: 10px;
    }
    .note-title {
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 8px;
    }
    .note-author {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .note-author-avatar {
      width: 18px;
      height: 18px;
      border-radius: 50%;
    }
    .note-author-name {
      font-size: 11px;
      color: var(--text-tertiary);
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .note-likes {
      font-size: 11px;
      color: var(--text-tertiary);
      display: flex;
      align-items: center;
      gap: 2px;
    }
    .note-likes svg {
      width: 12px;
      height: 12px;
    }

    /* åšä¸»ç»“æœ */
    .creators-list {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .creator-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-primary);
      border-radius: 12px;
      cursor: pointer;
      text-decoration: none;
    }
    .creator-avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      object-fit: cover;
    }
    .creator-info {
      flex: 1;
      min-width: 0;
    }
    .creator-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    .creator-bio {
      font-size: 13px;
      color: var(--text-tertiary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .creator-follow-btn {
      padding: 6px 16px;
      border-radius: 16px;
      background: var(--xhs-red);
      color: white;
      font-size: 13px;
      border: none;
      cursor: pointer;
    }

    /* ç©ºçŠ¶æ€ */
    .empty-state {
      padding: 60px 20px;
      text-align: center;
      color: var(--text-tertiary);
      font-size: 14px;
    }

    /* é«˜äº®å…³é”®è¯ */
    .highlight {
      color: var(--xhs-red);
    }
  </style>
</head>
<body>
  <!-- æœç´¢å¤´éƒ¨ -->
  <header class="header">
    <a href="javascript:history.back()" class="back-btn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </a>
    <div class="search-input-wrapper">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
      <input type="text" class="search-input" id="search-input" placeholder="æœç´¢ç¬”è®°ã€åšä¸»" autofocus>
      <div class="clear-btn" id="clear-btn" onclick="clearSearch()">Ã—</div>
    </div>
    <span class="search-btn" onclick="doSearch()">æœç´¢</span>
  </header>

  <!-- ä¸»å†…å®¹ -->
  <main class="main-content">
    <!-- æœç´¢å»ºè®®åŒºåŸŸ -->
    <div id="suggest-area">
      <!-- æœç´¢å†å² -->
      <div class="suggest-section" id="history-section">
        <div class="suggest-header">
          <span class="suggest-title">æœç´¢å†å²</span>
          <span class="suggest-clear" onclick="clearHistory()">æ¸…ç©º</span>
        </div>
        <div class="suggest-tags" id="history-tags"></div>
      </div>

      <!-- çƒ­é—¨æœç´¢ -->
      <div class="suggest-section" style="margin-top: 8px;">
        <div class="suggest-header">
          <span class="suggest-title">å¤§å®¶éƒ½åœ¨æœ</span>
        </div>
        <div class="suggest-tags" id="hot-tags"></div>
      </div>

      <!-- çƒ­æœæ¦œ -->
      <div class="hot-section">
        <div class="suggest-header">
          <span class="suggest-title">ğŸ”¥ çƒ­æœæ¦œ</span>
        </div>
        <div class="hot-list" id="hot-list"></div>
      </div>
    </div>

    <!-- æœç´¢ç»“æœåŒºåŸŸ -->
    <div class="result-section" id="result-area">
      <div class="result-tabs">
        <div class="result-tab active" data-type="all">ç»¼åˆ</div>
        <div class="result-tab" data-type="notes">ç¬”è®°</div>
        <div class="result-tab" data-type="creators">åšä¸»</div>
      </div>
      <div id="result-content"></div>
    </div>
  </main>

  <script>
    const searchInput = document.getElementById('search-input')
    const clearBtn = document.getElementById('clear-btn')
    let searchHistory = JSON.parse(localStorage.getItem('searchHistory') || '[]')

    const hotSearches = [
      'å†¬å­£æŠ¤è‚¤', 'ç©¿æ­çµæ„Ÿ', 'å‡è„‚é£Ÿè°±', 'æ—…è¡Œæ”»ç•¥',
      'ç§Ÿæˆ¿æ”¹é€ ', 'å¥èº«è®¡åˆ’', 'æ•°ç æµ‹è¯„', 'è€ƒç ”ç»éªŒ'
    ]

    const hotList = [
      { title: 'å†¬å­£æŠ¤è‚¤å¿…å¤‡å¥½ç‰©', badge: 'hot', heat: 128000 },
      { title: 'æ–°å¹´ç©¿æ­çµæ„Ÿ', badge: 'new', heat: 96000 },
      { title: 'ä¸€äººé£Ÿä¹Ÿè¦å¥½å¥½åƒ', badge: '', heat: 85000 },
      { title: 'å°ä¼—æ—…è¡Œç›®çš„åœ°', badge: '', heat: 72000 },
      { title: 'ä½æˆæœ¬ç§Ÿæˆ¿æ”¹é€ ', badge: '', heat: 68000 },
      { title: 'å¸•æ¢…æ‹‰æš´æ±—è®¡åˆ’', badge: 'hot', heat: 62000 },
      { title: 'iPhone ä½¿ç”¨æŠ€å·§', badge: '', heat: 58000 },
      { title: 'é«˜æ•ˆå­¦ä¹ æ–¹æ³•', badge: '', heat: 52000 },
    ]

    const coverGradients = [
      'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
      'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
      'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
      'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
    ]

    const categoryEmoji = {
      'beauty': 'ğŸ’„', 'fashion': 'ğŸ‘—', 'food': 'ğŸœ',
      'travel': 'âœˆï¸', 'home': 'ğŸ ', 'fitness': 'ğŸ’ª',
      'tech': 'ğŸ“±', 'study': 'ğŸ“š'
    }

    // åˆå§‹åŒ–
    function init() {
      // æ£€æŸ¥ URL å‚æ•°
      const q = new URLSearchParams(location.search).get('q')
      if (q) {
        searchInput.value = q
        doSearch()
      }

      renderHistory()
      renderHotSearches()
      renderHotList()

      // ç›‘å¬è¾“å…¥
      searchInput.addEventListener('input', () => {
        clearBtn.classList.toggle('show', searchInput.value.length > 0)
      })

      // å›è½¦æœç´¢
      searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') doSearch()
      })

      // æ ‡ç­¾é¡µåˆ‡æ¢
      document.querySelectorAll('.result-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.result-tab').forEach(t => t.classList.remove('active'))
          tab.classList.add('active')
          renderResults(tab.dataset.type)
        })
      })
    }

    // æ¸²æŸ“æœç´¢å†å²
    function renderHistory() {
      const container = document.getElementById('history-tags')
      const section = document.getElementById('history-section')

      if (searchHistory.length === 0) {
        section.style.display = 'none'
        return
      }

      section.style.display = 'block'
      container.innerHTML = searchHistory.slice(0, 10).map(term =>
        `<div class="suggest-tag" onclick="searchTerm('${escapeHtml(term)}')">${escapeHtml(term)}</div>`
      ).join('')
    }

    // æ¸²æŸ“çƒ­é—¨æœç´¢
    function renderHotSearches() {
      const container = document.getElementById('hot-tags')
      container.innerHTML = hotSearches.map(term =>
        `<div class="suggest-tag" onclick="searchTerm('${term}')">${term}</div>`
      ).join('')
    }

    // æ¸²æŸ“çƒ­æœæ¦œ
    function renderHotList() {
      const container = document.getElementById('hot-list')
      container.innerHTML = hotList.map((item, index) => {
        let rankClass = 'normal'
        if (index === 0) rankClass = 'top1'
        else if (index === 1) rankClass = 'top2'
        else if (index === 2) rankClass = 'top3'

        let badge = ''
        if (item.badge === 'hot') badge = '<span class="hot-badge hot">çƒ­</span>'
        else if (item.badge === 'new') badge = '<span class="hot-badge new">æ–°</span>'

        return `
          <div class="hot-item" onclick="searchTerm('${item.title}')">
            <span class="hot-rank ${rankClass}">${index + 1}</span>
            <div class="hot-content">
              <span class="hot-title">${item.title}${badge}</span>
            </div>
            <span class="hot-heat">${formatNumber(item.heat)}</span>
          </div>
        `
      }).join('')
    }

    // æœç´¢æŒ‡å®šè¯
    function searchTerm(term) {
      searchInput.value = term
      doSearch()
    }

    // æ‰§è¡Œæœç´¢
    let searchResults = { notes: [], creators: [] }

    async function doSearch() {
      const query = searchInput.value.trim()
      if (!query) return

      // ä¿å­˜å†å²
      addToHistory(query)
      clearBtn.classList.add('show')

      // æ˜¾ç¤ºç»“æœåŒºåŸŸ
      document.getElementById('suggest-area').style.display = 'none'
      document.getElementById('result-area').classList.add('show')

      // æœç´¢ç¬”è®°å’Œåšä¸»
      try {
        const [notesRes, creatorsRes] = await Promise.all([
          fetch(`/api/search/notes?q=${encodeURIComponent(query)}`),
          fetch(`/api/search/creators?q=${encodeURIComponent(query)}`)
        ])

        searchResults.notes = await notesRes.json()
        searchResults.creators = await creatorsRes.json()

        renderResults('all')
      } catch (e) {
        console.error('æœç´¢å¤±è´¥', e)
        document.getElementById('result-content').innerHTML = '<div class="empty-state">æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•</div>'
      }
    }

    // æ¸²æŸ“æœç´¢ç»“æœ
    function renderResults(type) {
      const container = document.getElementById('result-content')
      const query = searchInput.value.trim()

      if (type === 'all') {
        // ç»¼åˆç»“æœ
        if (searchResults.notes.length === 0 && searchResults.creators.length === 0) {
          container.innerHTML = '<div class="empty-state">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ</div>'
          return
        }

        let html = ''

        // åšä¸»ç»“æœï¼ˆæœ€å¤šæ˜¾ç¤º 3 ä¸ªï¼‰
        if (searchResults.creators.length > 0) {
          html += '<div class="creators-list">'
          html += searchResults.creators.slice(0, 3).map(creator => `
            <a href="/creator.html?id=${creator.id}" class="creator-item">
              <img class="creator-avatar" src="${creator.avatar}" alt="">
              <div class="creator-info">
                <div class="creator-name">${highlightText(creator.name, query)}</div>
                <div class="creator-bio">${escapeHtml(creator.bio || '')}</div>
              </div>
              <button class="creator-follow-btn" onclick="event.preventDefault();event.stopPropagation();">å…³æ³¨</button>
            </a>
          `).join('')
          html += '</div>'
        }

        // ç¬”è®°ç»“æœ
        if (searchResults.notes.length > 0) {
          html += '<div class="notes-grid">'
          html += renderNoteCards(searchResults.notes, query)
          html += '</div>'
        }

        container.innerHTML = html
      } else if (type === 'notes') {
        if (searchResults.notes.length === 0) {
          container.innerHTML = '<div class="empty-state">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç¬”è®°</div>'
          return
        }
        container.innerHTML = '<div class="notes-grid">' + renderNoteCards(searchResults.notes, query) + '</div>'
      } else if (type === 'creators') {
        if (searchResults.creators.length === 0) {
          container.innerHTML = '<div class="empty-state">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³åšä¸»</div>'
          return
        }
        container.innerHTML = '<div class="creators-list">' + searchResults.creators.map(creator => `
          <a href="/creator.html?id=${creator.id}" class="creator-item">
            <img class="creator-avatar" src="${creator.avatar}" alt="">
            <div class="creator-info">
              <div class="creator-name">${highlightText(creator.name, query)}</div>
              <div class="creator-bio">${escapeHtml(creator.bio || '')}</div>
            </div>
            <button class="creator-follow-btn" onclick="event.preventDefault();event.stopPropagation();">å…³æ³¨</button>
          </a>
        `).join('') + '</div>'
      }
    }

    // æ¸²æŸ“ç¬”è®°å¡ç‰‡
    function renderNoteCards(notes, query) {
      return notes.map((note, index) => {
        const gradient = coverGradients[index % coverGradients.length]
        const emoji = categoryEmoji[note.category] || 'ğŸ“'
        return `
          <a href="/note.html?id=${note.id}" class="note-card">
            <div class="note-cover" style="background: ${gradient}">
              ${emoji}
            </div>
            <div class="note-info">
              <div class="note-title">${highlightText(note.title, query)}</div>
              <div class="note-author">
                <img class="note-author-avatar" src="${note.creator_avatar}" alt="">
                <span class="note-author-name">${escapeHtml(note.creator_name)}</span>
                <span class="note-likes">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                  </svg>
                  ${formatNumber(note.likes)}
                </span>
              </div>
            </div>
          </a>
        `
      }).join('')
    }

    // é«˜äº®å…³é”®è¯
    function highlightText(text, query) {
      if (!query) return escapeHtml(text)
      const escaped = escapeHtml(text)
      const regex = new RegExp(`(${escapeRegex(query)})`, 'gi')
      return escaped.replace(regex, '<span class="highlight">$1</span>')
    }

    function escapeRegex(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
    }

    // æ·»åŠ åˆ°å†å²
    function addToHistory(term) {
      searchHistory = searchHistory.filter(t => t !== term)
      searchHistory.unshift(term)
      searchHistory = searchHistory.slice(0, 20)
      localStorage.setItem('searchHistory', JSON.stringify(searchHistory))
      renderHistory()
    }

    // æ¸…ç©ºå†å²
    function clearHistory() {
      searchHistory = []
      localStorage.removeItem('searchHistory')
      renderHistory()
    }

    // æ¸…ç©ºæœç´¢
    function clearSearch() {
      searchInput.value = ''
      clearBtn.classList.remove('show')
      document.getElementById('suggest-area').style.display = 'block'
      document.getElementById('result-area').classList.remove('show')
      searchInput.focus()
    }

    function formatNumber(num) {
      if (num >= 10000) return (num / 10000).toFixed(1) + 'w'
      if (num >= 1000) return (num / 1000).toFixed(1) + 'k'
      return num
    }

    function escapeHtml(text) {
      const div = document.createElement('div')
      div.textContent = text
      return div.innerHTML
    }

    init()
  </script>
</body>
</html>
